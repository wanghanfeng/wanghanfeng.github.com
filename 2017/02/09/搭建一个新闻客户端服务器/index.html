<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>搭建一个新闻客户端服务器 | 王韩峰的博客</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">搭建一个新闻客户端服务器</h1><a id="logo" href="/.">王韩峰的博客</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">搭建一个新闻客户端服务器</h1><div class="post-meta">Feb 9, 2017<span> | </span><span class="category"><a href="/categories/服务器搭建/">服务器搭建</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#项目分析"><span class="toc-number">1.</span> <span class="toc-text">项目分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#接口测试与改造"><span class="toc-number">2.</span> <span class="toc-text">接口测试与改造</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql数据库建表"><span class="toc-number">3.</span> <span class="toc-text">mysql数据库建表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#php后台"><span class="toc-number">4.</span> <span class="toc-text">php后台</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#项目部署到服务器"><span class="toc-number">5.</span> <span class="toc-text">项目部署到服务器</span></a></li></ol></div></div><div class="post-content"><hr>
<blockquote>
<p>iOS app 源码地址：<a href="https://github.com/wanghanfeng/LanYunNews" target="_blank" rel="external">https://github.com/wanghanfeng/LanYunNews</a><br>php 后台源码地址： <a href="https://github.com/wanghanfeng/NewsServer" target="_blank" rel="external">https://github.com/wanghanfeng/NewsServer</a><br>目前正在完善中，在此先来记录下开发的过程</p>
</blockquote>
<p>这里主要介绍服务器的搭建，app的实现不做介绍。</p>
<h3 id="项目分析"><a href="#项目分析" class="headerlink" title="项目分析"></a>项目分析</h3><p>做一个新闻客户端的app最首先需要拿到需要展示的新闻数据，目前来说可行的方案有两种：<br>1、写一个爬虫去各大门户的新闻首页上爬去新闻的标题和新闻的url，存入数据库提供给app使用。（后期实现）<br>2、使用现成新闻api接口,如聚合数据。因为聚合数据的新闻接口是可以免费使用的，所以我选择使用聚合数据的新闻接口。</p>
<h3 id="接口测试与改造"><a href="#接口测试与改造" class="headerlink" title="接口测试与改造"></a>接口测试与改造</h3><p>使用post方式向<a href="http://v.juhe.cn/toutiao/index" target="_blank" rel="external">http://v.juhe.cn/toutiao/index</a> 发送数据，必须带上字段type和申请的app key，以下是实例，大家可以使用我的app key，免去申请的麻烦。<br><img src="http://upload-images.jianshu.io/upload_images/2312315-0a4155ee95234bc9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Snip20170209_2.png"><br>我们可以得到返回回来的json数据，data字段中是一个数组，里面就是返回的30条新闻数据。这个接口有一个缺点，就是只能获取到最新的30条数据，无法获取这之前的新闻数据，如果用户看完了这30条，就没有其他更多的数据可以浏览了。<br>真正需要的api应该再增加一个字段page,用来表示我们需要获取到新闻的条目，例如每一页拥有30条数据，0页代表最新的30条，1页代表之后的30条，一次类推。<br>现在最大的问题是现有的api没有这个字段，于是考虑搭建一个服务器提供一个新的api。</p>
<h3 id="mysql数据库建表"><a href="#mysql数据库建表" class="headerlink" title="mysql数据库建表"></a>mysql数据库建表</h3><p>首先分析下收到的新闻数据格式：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"uniquekey"</span>:<span class="string">"e83c8565b142a3be8897e70323f0e767"</span>,</div><div class="line"><span class="attr">"title"</span>:<span class="string">"魅族商城遭域名劫持？高管在朋友圈呼吁：请友商理性竞争！"</span>,</div><div class="line"><span class="attr">"date"</span>:<span class="string">"2017-02-09 17:23"</span>,</div><div class="line"><span class="attr">"category"</span>:<span class="string">"科技"</span>,</div><div class="line"><span class="attr">"author_name"</span>:<span class="string">"APP皮皮爱应用"</span>,</div><div class="line"><span class="attr">"url"</span>:<span class="string">"http:\/\/mini.eastday.com\/mobile\/170209172306465.html"</span>,</div><div class="line"><span class="attr">"thumbnail_pic_s"</span>:<span class="string">"http:\/\/04.imgmini.eastday.com\/mobile\/20170209\/20170209172306_e49c5df82cb0232c2371932a5e48169e_1_mwpm_03200403.jpeg"</span>,</div><div class="line"><span class="attr">"thumbnail_pic_s02"</span>:<span class="string">"http:\/\/04.imgmini.eastday.com\/mobile\/20170209\/20170209172306_e49c5df82cb0232c2371932a5e48169e_2_mwpm_03200403.jpeg"</span>,</div><div class="line"><span class="attr">"thumbnail_pic_s03"</span>:<span class="string">"http:\/\/04.imgmini.eastday.com\/mobile\/20170209\/20170209172306_e49c5df82cb0232c2371932a5e48169e_3_mwpm_03200403.jpeg"</span>&#125;</div></pre></td></tr></table></figure></p>
<p>一条最新闻最少需要9个字段才可以存储在数据库中，其意义也能很清楚的根据英文名称辨别出来，所以根据其格式建表如下，表名news：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2312315-3945906715b0d7e9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Snip20170209_5.png"></p>
<blockquote>
<p>Tip:<br>因为原api接口的特殊性，每次请求都是最新的30条数据，但是新闻数据在短时间内不可能变化的太快，所以当后台每1分钟去请求下原接口并将得到的数据插入数据库中就会出现大量的重复数据，而数据库执行distinct去重操作又是效率非常低下的于是又有如下几个方案：<br>1.查看响应头中 Last-Modified 字段，检测文件在浏览器最后的修改时间，如果发现文件未被修改则不插入数据库，反之插入。（原api接口中无此字段，不采用）<br>2.对收到的数据做Hash值计算，与上一次的收到的数据Hash值比较，如果不相等则将收到的数据插入数据库，相等则舍弃。（每次计算Hash值时耗时太长，比较明显，不采用）<br>3.由于mysql的特点，每次插入数据时检测当前数据的主键与表中数据的主键是否重复，重复则插入失败。因为这是无法避免的耗时，所以可以利用这一点实现去重操作，根据原api返回的uniquekey作为主键，向数据库内插入数据，如果数据库内存在相同新闻那么uniquekey必然重复导致数据库插入失败，达到去重的目的。（采用）</p>
</blockquote>
<p>把uniquekey当做主键，省去了管理主键的麻烦。每条数据的标题不能为空，一旦标题为空在客户端展示是就会出现“无头新闻”用户体验不佳，所以宁肯数据插入失败也不希望它在用户的设备上显示出来。</p>
<h3 id="php后台"><a href="#php后台" class="headerlink" title="php后台"></a>php后台</h3><p>项目中用到了mysql和php,使用xampp集成化工具比较方便，xampp集成了MySQL(MariaDB)、ProFTPD、Apache Web Server,一键配置比较方便。</p>
<blockquote>
<p>Tip:<br>xampp支持Windows、Mac、Linux环境<br>初次安装xampp时，MySQL的初始化密码为空。<br>笔者建议先将项目在本机上测试后再部署的服务器上。</p>
</blockquote>
<p>这是php项目的入口文件，由于需要改写原有api,在原有的api基础上定制自己的api,所以需要模拟post请求，先向原有api去post得到结果后再进行分析返回给app端。php中没有现成的post函数，于是自己封装了个函数来模拟post请求，在php中实现post请求有很多种方法，笔者的方法是其中之一，仅用做参考。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//index.php</span></div><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by PhpStorm.</div><div class="line"> * User: whf</div><div class="line"> * Date: 17/2/8</div><div class="line"> * Time: 下午4:20</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">include</span> <span class="string">'sqlLink.php'</span>;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 发送post请求</div><div class="line"> * <span class="doctag">@param</span> string $url 请求地址</div><div class="line"> * <span class="doctag">@param</span> array $post_data post键值对数据</div><div class="line"> * <span class="doctag">@return</span> array </div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">send_post</span><span class="params">($url, $post_data)</span> </span>&#123;</div><div class="line"></div><div class="line">    $postdata = http_build_query($post_data);</div><div class="line">    $options = <span class="keyword">array</span>(</div><div class="line">        <span class="string">'http'</span> =&gt; <span class="keyword">array</span>(</div><div class="line">            <span class="string">'method'</span> =&gt; <span class="string">'POST'</span>,</div><div class="line">            <span class="string">'header'</span> =&gt; <span class="string">'Content-type:application/x-www-form-urlencoded'</span>,</div><div class="line">            <span class="string">'content'</span> =&gt; $postdata,</div><div class="line">            <span class="string">'timeout'</span> =&gt; <span class="number">0.5</span> * <span class="number">60</span> <span class="comment">// 超时时间（单位:s）</span></div><div class="line">        )</div><div class="line">    );</div><div class="line">    $context = stream_context_create($options);</div><div class="line">    $body = file_get_contents($url, <span class="keyword">false</span>, $context);</div><div class="line">    <span class="comment">//获取响应头</span></div><div class="line">    $header = $http_response_header;</div><div class="line"></div><div class="line">    $result = [</div><div class="line">        <span class="string">'header'</span> =&gt; $header,</div><div class="line">        <span class="string">'body'</span> =&gt; $body</div><div class="line">    ];</div><div class="line">    <span class="keyword">return</span> $result;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$post_data = <span class="keyword">array</span>(</div><div class="line">    <span class="string">'type'</span> =&gt; <span class="string">'keji'</span>,</div><div class="line">    <span class="string">'key'</span> =&gt; <span class="string">'9b36e7f06020e794a3547c5718bc114c'</span></div><div class="line">);</div><div class="line">$res = send_post(<span class="string">'https://v.juhe.cn/toutiao/index'</span>, $post_data)[<span class="string">'body'</span>];</div><div class="line"></div><div class="line"><span class="comment">//打印响应头</span></div><div class="line"><span class="comment">//foreach ($res as $key =&gt; $value)&#123;</span></div><div class="line"><span class="comment">//    echo $value .'&lt;br/&gt;';</span></div><div class="line"><span class="comment">//&#125;</span></div><div class="line"></div><div class="line">$arr = json_decode($res,<span class="keyword">true</span>);</div><div class="line"><span class="keyword">echo</span> json_encode($arr);</div><div class="line"><span class="comment">//把数据写入数据库保存</span></div><div class="line"><span class="keyword">foreach</span> ($arr[<span class="string">'result'</span>][<span class="string">'data'</span>] <span class="keyword">as</span> $v)&#123;</div><div class="line">    writeTable(<span class="string">'news'</span>,$v);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">($v)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span> (is_array($v))&#123;</div><div class="line">        <span class="keyword">foreach</span> ($v <span class="keyword">as</span> $key =&gt; $value)&#123;</div><div class="line">            <span class="keyword">if</span> (is_array($value))&#123;</div><div class="line">                show($value);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span>&#123;</div><div class="line">                <span class="keyword">echo</span> $key . <span class="string">' : '</span> . $value .<span class="string">'&lt;br/&gt;'</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//show($arr['result']['data']);</span></div></pre></td></tr></table></figure>
<p>在获取到数据后直接将数据写入数据库，由数据库来判断当前插入的这一条是否与数据库中其他条目重复。</p>
<p>send_post($url, $post_data)方法需要传入url和post的body($post_data),返回一个数组，可以使用array[‘header’]来获取响应头，array[‘body’]获取响应体。当然这个函数封装的还是不够完美，缺少请求头参数的传入，由于原有api不需要传入请求头，所以没有实现，现在将send_post函数改造如下，以便达到“完美”：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 发送post请求</div><div class="line"> * <span class="doctag">@param</span> string $url 请求地址</div><div class="line"> * <span class="doctag">@param</span> array $post_data post键值对数据</div><div class="line"> * <span class="doctag">@param</span> array $header_arr post请求头</div><div class="line"> * <span class="doctag">@return</span> array</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">send_post</span><span class="params">($url,$post_data, $header_arr=null)</span> </span>&#123;</div><div class="line"></div><div class="line">    $postdata = http_build_query($post_data);</div><div class="line">    $header = <span class="string">''</span>;</div><div class="line">    <span class="keyword">if</span> ($header_arr)&#123;</div><div class="line">        <span class="keyword">foreach</span> ($header_arr <span class="keyword">as</span> $key =&gt; $value)&#123;</div><div class="line">            $header = $header . $key . <span class="string">':'</span> .$value . <span class="string">'\n'</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (strlen($header)!=<span class="number">0</span>)&#123;</div><div class="line">        $header = substr($header,<span class="number">0</span>,strlen($header)<span class="number">-1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span>&#123;</div><div class="line">        $header = <span class="string">'Content-type:application/x-www-form-urlencoded'</span>;</div><div class="line">    &#125;</div><div class="line">    $options = <span class="keyword">array</span>(</div><div class="line">        <span class="string">'http'</span> =&gt; <span class="keyword">array</span>(</div><div class="line">            <span class="string">'method'</span> =&gt; <span class="string">'POST'</span>,</div><div class="line">            <span class="string">'header'</span> =&gt; $header,</div><div class="line">            <span class="string">'content'</span> =&gt; $postdata,</div><div class="line">            <span class="string">'timeout'</span> =&gt; <span class="number">0.5</span> * <span class="number">60</span> <span class="comment">// 超时时间（单位:s）</span></div><div class="line">        )</div><div class="line">    );</div><div class="line">    $context = stream_context_create($options);</div><div class="line">    $body = file_get_contents($url, <span class="keyword">false</span>, $context);</div><div class="line">    <span class="comment">//获取响应头</span></div><div class="line">    $header = $http_response_header;</div><div class="line"></div><div class="line">    $result = [</div><div class="line">        <span class="string">'header'</span> =&gt; $header,</div><div class="line">        <span class="string">'body'</span> =&gt; $body</div><div class="line">    ];</div><div class="line">    <span class="keyword">return</span> $result;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在sqlLink.php文件中，主要是封装了对数据库的操作，由index.php来调用:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">/**</div><div class="line"> * Created by PhpStorm.</div><div class="line"> * User: whf</div><div class="line"> * Date: 17/2/8</div><div class="line"> * Time: 下午5:46</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="variable">$conn</span> = mysqli_connect(<span class="string">'localhost'</span>,<span class="string">'root'</span>,<span class="string">''</span>,<span class="string">'news_server'</span>);</div><div class="line">mysqli_set_charset(<span class="variable">$conn</span>,<span class="string">'utf8'</span>);</div><div class="line"></div><div class="line"><span class="keyword">function</span> writeTable(<span class="variable">$tableName</span>,<span class="variable">$item</span>)&#123;</div><div class="line">    global <span class="variable">$conn</span>;</div><div class="line">    </div><div class="line">    <span class="variable">$value</span> = <span class="string">''</span>;</div><div class="line">    foreach (<span class="variable">$item</span> as <span class="variable">$v</span>)&#123;</div><div class="line">        <span class="variable">$value</span> = <span class="variable">$value</span> . <span class="string">'"'</span> . <span class="variable">$v</span> . <span class="string">'"'</span> . <span class="string">','</span>;</div><div class="line">    &#125;</div><div class="line">    //处理当长度不匹配时插入数据库报错</div><div class="line">    <span class="keyword">if</span> (count(<span class="variable">$item</span>)==7)&#123;</div><div class="line">        <span class="variable">$value</span> = <span class="variable">$value</span> . <span class="string">"null"</span> . <span class="string">','</span> . <span class="string">"null"</span> . <span class="string">','</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (count(<span class="variable">$item</span>)==8)&#123;</div><div class="line">        <span class="variable">$value</span> = <span class="variable">$value</span> . <span class="string">"null"</span> . <span class="string">','</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (strlen(<span class="variable">$value</span>)!=0)&#123;</div><div class="line">        <span class="variable">$value</span> = substr(<span class="variable">$value</span>,0,strlen(<span class="variable">$value</span>)-1);</div><div class="line">    &#125;</div><div class="line">    <span class="variable">$sql</span> = <span class="string">"insert into <span class="variable">$tableName</span> VALUES (<span class="variable">$value</span>)"</span>;</div><div class="line">//    <span class="built_in">echo</span> <span class="string">'数据库写入成功!'</span> . <span class="variable">$sql</span> . <span class="string">'&lt;br/&gt;'</span>;</div><div class="line">    <span class="keyword">if</span> (!mysqli_query(<span class="variable">$conn</span>,<span class="variable">$sql</span>))&#123;</div><div class="line">//        <span class="built_in">echo</span> <span class="string">'数据库写入失败!'</span> . <span class="variable">$sql</span> .<span class="string">'&lt;br/&gt;'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//<span class="keyword">function</span> <span class="built_in">read</span>Table(<span class="variable">$tableName</span>,$)</div></pre></td></tr></table></figure></p>
<p>由于项目实现的功能比较简单，所以采用面向过程编程比较简单。</p>
<h3 id="项目部署到服务器"><a href="#项目部署到服务器" class="headerlink" title="项目部署到服务器"></a>项目部署到服务器</h3><p>在项目已经测试过之后，便要将其部署到云端服务器上。（笔者的服务器选用的是阿里云的linux系统。）<br>使用下面的命令：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">ssh</span> <span class="selector-tag">root</span>@<span class="keyword">42</span>.<span class="keyword">96</span>.<span class="keyword">203</span>.<span class="keyword">33</span></div></pre></td></tr></table></figure></p>
<p>之后输入密码<br>xampp在linux上的安装就不过多介绍了，官网上有安装介绍。<br>接下来进入xampp的安装目录<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">cd</span> /<span class="keyword">opt</span>/lampp/htdocs</div></pre></td></tr></table></figure></p>
<p>htdocs文件夹是xampp默认的项目目录，将项目部署在这里，之后就可以通过<a href="http://serverName/porjName" target="_blank" rel="external">http://serverName/porjName</a> 来访问项目了，如果想直接访问域名就能访问到项目，就将htdoc下的index.php文件替换成项目的index.php文件（著名php框架CodeIgniter就是这么做的）。</p>
<p>接下来配置mysql:<br>xampp自带mysql,但是自带的mysql并不是全局的，如果想将mysql注册成为全局的环境变量，在用户目录下的.bash_profile文件中增加变量。这里笔者先不设置,切换到mysql的目录下：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">cd</span> /<span class="keyword">opt</span>/lampp/bin</div></pre></td></tr></table></figure></p>
<p>输入命令 启动mysql(由于xampp自带的mysql没有启用密码，所以可以直接进入)<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./mysql</div></pre></td></tr></table></figure></p>
<p>接下来先建立一个数据库：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">create</span> <span class="keyword">database</span> news_server <span class="built_in">character</span> <span class="keyword">set</span> utf8;</div></pre></td></tr></table></figure></p>
<p>选中数据库：<br><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">use <span class="keyword">new</span><span class="type">s_server</span>;</div></pre></td></tr></table></figure></p>
<p>导入.sql文件，MySQL会自动创建表<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line"> Navicat Premium Data Transfer</div><div class="line"></div><div class="line"> Source Server         : MySQL_Navicat</div><div class="line"> Source Server Type    : MySQL</div><div class="line"> Source Server Version : 50505</div><div class="line"> Source Host           : localhost</div><div class="line"> Source Database       : news_server</div><div class="line"></div><div class="line"> Target Server Type    : MySQL</div><div class="line"> Target Server Version : 50505</div><div class="line"> File Encoding         : utf-8</div><div class="line"></div><div class="line"> Date: 02/08/2017 19:17:49 PM</div><div class="line">*/</div><div class="line"></div><div class="line"><span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8;</div><div class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS = <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="comment">-- ----------------------------</span></div><div class="line"><span class="comment">--  Table structure for `news`</span></div><div class="line"><span class="comment">-- ----------------------------</span></div><div class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`news`</span>;</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`news`</span> (</div><div class="line">  <span class="string">`uniquekey`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`title`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`date`</span> <span class="built_in">varchar</span>(<span class="number">16</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`category`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`author_name`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`url`</span> <span class="built_in">varchar</span>(<span class="number">256</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`thumbnail_pic_s`</span> <span class="built_in">varchar</span>(<span class="number">256</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`thumbnail_pic_s02`</span> <span class="built_in">varchar</span>(<span class="number">256</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`thumbnail_pic_s03`</span> <span class="built_in">varchar</span>(<span class="number">256</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`uniquekey`</span>)</div><div class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</div><div class="line"></div><div class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS = <span class="number">1</span>;</div></pre></td></tr></table></figure></p>
<p>这个新闻客户端服务器就已经可以使用了，新的api就是<a href="http://servername/porjName" target="_blank" rel="external">http://serverName/porjName</a>  ，可以向这个url上post数据，具体需要实现什么样的功能和参数，可以自己更改php代码来实现。</p>
<blockquote>
<p>现在新闻客户端服务器还不完善，我正在努力完善中，之后再来更新文章。欢迎各位志同道合同志与我共同交流切磋，高手绕行 ：）❤</p>
</blockquote>
<hr>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://wanghanfeng.com/2017/02/09/搭建一个新闻客户端服务器/" data-id="cj08ym3ap001754u2exqm1n1y" class="article-share-link">分享到</a><div class="tags"><a href="/tags/PHP/">PHP</a></div><div class="post-nav"><a href="/2017/02/10/网络请求缓存之无网络/" class="pre">网络请求缓存之无网络</a><a href="/2017/01/11/在Mac-OS-X-自定义快捷键打开应用/" class="next">在Mac OS X 自定义快捷键打开应用</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="http://wanghanfeng.com"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Mac操作/">Mac操作</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS-iTunes/">iOS iTunes</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS-开发/">iOS 开发</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务器搭建/">服务器搭建</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法与数据结构/">算法与数据结构</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机网络/">计算机网络</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/github/" style="font-size: 15px;">github</a> <a href="/tags/AFNetworking-Objective-C/" style="font-size: 15px;">AFNetworking  Objective-C</a> <a href="/tags/Block/" style="font-size: 15px;">Block</a> <a href="/tags/jquery/" style="font-size: 15px;">jquery</a> <a href="/tags/location/" style="font-size: 15px;">location</a> <a href="/tags/网络协议/" style="font-size: 15px;">网络协议</a> <a href="/tags/数据持久化/" style="font-size: 15px;">数据持久化</a> <a href="/tags/component/" style="font-size: 15px;">component</a> <a href="/tags/框架/" style="font-size: 15px;">框架</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/runtime/" style="font-size: 15px;">runtime</a> <a href="/tags/Mac/" style="font-size: 15px;">Mac</a> <a href="/tags/排序/" style="font-size: 15px;">排序</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/算法与数据结构/" style="font-size: 15px;">算法与数据结构</a> <a href="/tags/苹果开发者/" style="font-size: 15px;">苹果开发者</a> <a href="/tags/垃圾回收/" style="font-size: 15px;">垃圾回收</a> <a href="/tags/网络优化/" style="font-size: 15px;">网络优化</a> <a href="/tags/iOS-开发/" style="font-size: 15px;">iOS 开发</a></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">王韩峰的博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>